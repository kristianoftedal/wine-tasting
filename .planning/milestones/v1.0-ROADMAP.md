# Milestone v1.0: Similarity Scoring

**Status:** SHIPPED 2026-02-07
**Phases:** 1-5
**Total Plans:** 9

## Overview

This roadmap transforms the similarity scoring system to reward specific tasting notes over generic terms. We start by analyzing real database vocabulary, restructure categories to match Vinmonopolet's standards, build a switchable weight profile system, ensure compatibility across environments, and validate improvements through testing.

## Phases

### Phase 1: Data Analysis

**Goal**: Understand actual Norwegian wine vocabulary used in the database
**Depends on**: Nothing (first phase)
**Requirements**: DATA-01, DATA-02, DATA-03, DATA-04
**Success Criteria** (what must be TRUE):
  1. All smell/taste notes extracted from Supabase wines table
  2. Frequency analysis shows most common terms and categories
  3. Missing terms identified that should be in lemma dictionary
  4. Existing typos in lemmas documented with corrections needed
**Plans**: 2 plans

Plans:
- [x] 01-01-PLAN.md — Extract wines from Supabase, analyze term frequency
- [x] 01-02-PLAN.md — Identify missing terms and typos in lemma dictionary

**Completed:** 2026-02-02

### Phase 2: Category Restructuring

**Goal**: Categories align with Vinmonopolet's official tasting wheel structure
**Depends on**: Phase 1 (need vocabulary data to validate categories)
**Requirements**: CAT-01, CAT-02, CAT-03, CAT-04
**Success Criteria** (what must be TRUE):
  1. Mørke bær and røde bær merged into unified frukt category
  2. Category structure matches Vinmonopolet aromahjul/smakshjul hierarchy
  3. Six main categories exist: Frukt, Krydder, Urter, Blomster, Eik/fat, Mineral
  4. Generic structure terms have lower category weights than specific descriptors
**Plans**: 2 plans

Plans:
- [x] 02-01-PLAN.md — Create categories module with hierarchy and validation script
- [x] 02-02-PLAN.md — Migrate lemmatizeAndWeight.ts to use new categories

**Completed:** 2026-02-03

### Phase 3: Weight Profile System

**Goal**: Three switchable weight profiles available for different scoring strategies
**Depends on**: Phase 2 (profiles depend on category structure)
**Requirements**: WGHT-01, WGHT-02, WGHT-03, WGHT-04, WGHT-05
**Success Criteria** (what must be TRUE):
  1. Configuration file or mechanism exists to switch between three profiles
  2. Inverted profile configured with specific notes 2.0-2.5, generic terms 0.8-1.2
  3. Moderate profile configured with specific notes 1.8-2.2, generic terms 1.0-1.5
  4. Data-driven profile configured with weights based on database frequency analysis
  5. Switching profiles requires minimal effort (single config change or environment variable)
**Plans**: 1 plan

Plans:
- [x] 03-01-PLAN.md — Create profiles module with typed weights and env-based selection

**Completed:** 2026-02-06

### Phase 4: Quality Assurance

**Goal**: Localhost and server environments both work correctly with new scoring
**Depends on**: Phase 3 (need new scoring system to test)
**Requirements**: QUAL-01, QUAL-02, QUAL-03, QUAL-04
**Success Criteria** (what must be TRUE):
  1. Local environment uses Xenova embeddings without errors
  2. Server environment uses OpenAI embeddings without errors
  3. Both environments can switch between localhost/server modes correctly
  4. Existing API signatures unchanged (no breaking changes for consumers)
**Plans**: 2 plans

Plans:
- [x] 04-01-PLAN.md — Set up Vitest, write unit tests for lemmatization and profiles
- [x] 04-02-PLAN.md — Integration tests for localhost/server split, migration script

**Completed:** 2026-02-06

### Phase 5: Validation

**Goal**: Scoring improvements verified through before/after comparison
**Depends on**: Phase 4 (need working system to validate)
**Requirements**: VAL-01, VAL-02, VAL-03
**Success Criteria** (what must be TRUE):
  1. Test cases created with known note pairs showing expected behavior
  2. Before/after scores documented showing specific notes now score higher
  3. Manual testing in app confirms scoring rewards tasting skill appropriately
**Plans**: 2 plans

Plans:
- [x] 05-01-PLAN.md — Create validation script with test cases and multi-profile comparison
- [x] 05-02-PLAN.md — Execute validation, generate report, create manual testing checklist

**Completed:** 2026-02-07

---

## Milestone Summary

**Key Decisions:**

- Use tsx over ts-node for faster TypeScript execution
- Profile weights REPLACE base weights (not multiply)
- Data-driven profile uses frequency-based weights (common = high)
- Weight inversion: generic 0.8, specific 1.3+
- Berry merge: mørke bær + røde bær → unified bær category with weight 1.6
- Test expectations require >10% difference for pass/fail

**Issues Resolved:**

- Fixed module caching for profile switching (use require.cache deletion)
- Maintained backwards compatibility with flat category field

**Technical Debt Incurred:**

- None significant

---

*For current project status, see .planning/MILESTONES.md*
